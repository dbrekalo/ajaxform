!function(a){function b(c){this.options=a.extend({},b.defaults,c),this.init()}var c=0;a.extend(b.prototype,{init:function(){this.$el="string"==typeof this.options.el?a(this.options.el):this.options.el,this.ens=".ajaxForm"+ ++c,this.deferreds=[],this.hasErrors=!1,this.options.preloaded?this.$form=this.$el.find(this.options.formSelector):this.deferreds.push(a.get(this.options.url,a.proxy(this.render,this))),this.events()},events:function(){this.$el.on("submit"+this.ens,this.options.formSelector,a.proxy(function(a){a.preventDefault(),this.postForm()},this))},postForm:function(b){var c=a.post(this.options.url||this.$form.attr("action"),this.$form.serialize());return this.deferreds.push(c),a.when(c).done(a.proxy(function(a){b?this.hasErrors&&this.onSubmitSuccess(a):this.onSubmitSuccess(a)},this)).fail(a.proxy(function(a){a.status===this.options.validationErrorStatus?this.onValidationError(a.responseText):this.options.onSubmitFail&&this.options.onSubmitFail(a)},this)),c},render:function(a){this.$el.html(a),this.$form=this.$el.find(this.options.formSelector),this.options.afterRender&&this.options.afterRender(this.$form,this)},onSubmitSuccess:function(a){this.hasErrors=!1,this.options.onSubmitSuccess?this.options.onSubmitSuccess(a,this.$form,this):this.render(a),this.options.afterSubmitSuccess&&this.options.afterSubmitSuccess(a,this.$form,this)},onValidationError:function(a){this.hasErrors=!0,this.options.onValidationError?this.options.onValidationError(a,this.$form,this):this.render(a),this.options.afterValidationError&&this.options.afterValidationError(a,this.$form,this)},destroy:function(){this.$el.off(this.ens),a.each(this.deferreds,function(a,b){"pending"===b.state()&&b.abort()})}}),b.defaults={url:null,preloaded:!0,formSelector:"form",validationErrorStatus:400,afterRender:null,onValidationError:null,afterValidationError:null,onSubmitSuccess:null,afterSubmitSuccess:null,onSubmitFail:null},a.wk=a.wk||{},a.wk.ajaxForm=b,a.fn.ajaxForm=function(c){return this.each(function(){a.data(this,"ajaxForm")||a.data(this,"ajaxForm",new b(a.extend({el:a(this)},c)))})}}(window.jQuery||window.Zepto);